/* ===== 페이지 단위 스케일 (em 기준) ===== */
.tutorial-page {
  position: relative;
  width: 100%;
  min-height: 600px;
  background: rgba(254, 255, 245, 1);
  overflow: hidden;
  font-family: "Noto Sans KR", system-ui, -apple-system, Segoe UI, Roboto,
    sans-serif;
  touch-action: pan-y;
  padding-bottom: max(12px, var(--safe-bottom));

  /* 글씨 크기: 화면 폭에 맞게 비율 조정 (모바일 ~ 데스크탑) */
  font-size: clamp(14px, 2.5vw, 22px);
  cursor: default;
  user-select: none; /* ← 글자 드래그 방지 */
  -webkit-user-select: none; /* 사파리/모바일 */
  -ms-user-select: none; /* 구 IE 엣지 */
  -webkit-touch-callout: none; /* iOS 길게눌러 복사 메뉴 금지 */
}

/* 가로 슬라이더 */
.slider {
  display: flex;
  height: 100%;
  transition: transform 380ms ease;
}
.slide {
  position: relative; /* ★ 각 슬라이드 기준 */
  flex: 0 0 100%;
  min-height: 100svh;
  padding: 0;
  box-sizing: border-box;
  display: block;
  margin-top: 37px;
}

@supports (min-height: 100dvh) {
  .tutorial-page,
  .slide {
    min-height: 100dvh;
  }
}

/* === 공통 위치 변수 (요소 '중심'이 해당 퍼센트에 오도록) === */
:root {
  --safe-bottom: env(safe-area-inset-bottom, 0px);
  --safe-top: env(safe-area-inset-top, 0px);
  --top-gutter: 15px; /* ← 위 여백 크기(원하면 6~16px로 조절) */
  --top-offset: max(var(--safe-top), var(--top-gutter));
  --pos-title: 12vh;
  --pos-image: 40vh;
  --pos-desc: 65vh;
  --pos-dots: 78svh;
  --pos-footer: 85svh;
  /* iPad Pro 가로 기준 최대 폭 */
  --stage-max: 1366px;

  /* 캐릭터 크기(요청 값) */
  --charScale1: 0.86;
  --charScale2: 0.86;
  --charScale3: 1.22;

  /* 캐릭터 마키: 세트/이동량 (3세트 → 한 스텝 = 33.333…%) */
  --loop-count: 3;
  --loop-step: calc(100% / var(--loop-count)); /* = 33.333…% */
}

/* 제목 */
.title {
  position: absolute;
  top: var(--pos-title);
  left: 50%;
  transform: translate(-50%, -50%);
  margin: 0;
  font-weight: 800;
  font-size: 1.4em;
  color: #2a4b39;
  text-align: center;
}

/* 설명 */
.desc {
  position: absolute;
  top: var(--pos-desc);
  left: 50%;
  transform: translate(-50%, -50%);
  width: min(90%, 40em);
  margin: 0;
  font-size: 0.9em;
  line-height: 1.6;
  text-align: center;
  color: #3a4a3f;
}

/* 이미지 래퍼: 화면 폭 = 100vw, 최대는 iPad Pro 가로폭 */
.image-wrap {
  position: absolute;
  top: var(--pos-image);
  left: 50%;
  transform: translate(-50%, -50%);
  width: min(100vw, var(--stage-max));
  height: 40vh;
  min-height: 13.75em;
  display: flex;
  align-items: center;
  justify-content: center;
}

.hero-img {
  pointer-events: none;
  width: auto;
  max-width: 100%;
  max-height: 100%;
  display: block;
  object-fit: contain;
  filter: drop-shadow(0 1.125em 1.125em rgba(0, 0, 0, 0.12));
}

/* 2번째(로드맵)만 살짝 축소 */
.roadmap-img {
  transform: scale(0.85);
  transform-origin: center;
}

/* ===== 캐릭터 무한 루프 (3세트, iPad 등 넓은 폭에서도 이음새 없음) ===== */
.char-marquee-viewport {
  width: 100%;
  height: calc(8.5em * var(--charScale3) + 2em);
  overflow: hidden;
  position: relative;

  /* 가장자리 페이드(이음새 완전 숨김) */
  -webkit-mask-image: linear-gradient(
    to right,
    transparent 0,
    #000 3%,
    #000 97%,
    transparent 100%
  );
  mask-image: linear-gradient(
    to right,
    transparent 0,
    #000 3%,
    #000 97%,
    transparent 100%
  );
}

.char-marquee-track {
  display: flex;
  align-items: center;
  gap: 1.25em; /* 간격은 gap만 사용 (패딩/마진 X) */
  width: max-content;
  padding: 0;
  margin: 0;
  animation: char-loop-3 9s linear infinite; /* 3세트 기준 */
  will-change: transform;
}

.char-img {
  pointer-events: none;
  width: 8.5em;
  height: auto;
  flex: 0 0 auto;
  display: block;
  filter: drop-shadow(0 0.875em 1em rgba(0, 0, 0, 0.12));
}

/* 3개 주기 크기 차등 (복제 세트에도 동일 적용) */
.char-marquee-track img:nth-child(3n + 1) {
  width: calc(8.5em * var(--charScale1));
}
.char-marquee-track img:nth-child(3n + 2) {
  width: calc(8.5em * var(--charScale2));
}
.char-marquee-track img:nth-child(3n) {
  width: calc(8.5em * var(--charScale3));
}

/* 트랙 길이의 정확히 1/3만 이동 → 어떤 화면폭에서도 끊김 없음 */
@keyframes char-loop-3 {
  0% {
    transform: translate3d(0, 0, 0);
  }
  100% {
    transform: translate3d(calc(var(--loop-step) * -1), 0, 0);
  } /* = -33.333…% */
}

/* 인디케이터 */
.dots {
  position: absolute;
  top: calc(var(--pos-dots) - var(--safe-bottom));
  left: 50%;
  transform: translate(-50%, -50%);
  display: flex;
  gap: 0.5em;
}
.dot {
  width: 0.5em;
  height: 0.5em;
  border-radius: 35%;
  border: none;
  background: #d6e7da;
}
.dot.active {
  width: 1.375em;
  background: #40ea87;
}

/* 하단 CTA */
.footer {
  position: absolute;
  top: calc(var(--pos-footer) - var(--safe-bottom));
  left: 50%;
  transform: translate(-50%, -50%);
}
.start-btn {
  /* 더 넓게: 화면 80%까지, 최대 450px */
  width: min(80vw, 450px);
  height: 3.375em;
  border: none;
  border-radius: 0.875em;
  font-weight: 700;
  font-size: 1em;
  cursor: pointer;
}
.start-btn.disabled {
  background: #e9efe9;
  color: #9fb2a6;
}
.start-btn.enabled {
  background: #40ea87;
  color: #0f2a1b;
}
/* 컴팩트 1: 보통 소형 화면(≤780px 높이)에서 세로 간격 살짝 축소 */
@media (max-height: 915px) {
  :root {
    --pos-title: 9svh;
    --pos-image: 34svh;
    --pos-desc: 59svh;
    --pos-dots: 75svh;
    --pos-footer: 85svh;
  }
  .image-wrap {
    height: 32vh;
  }
  .title {
    font-size: 1.3em;
  }
  .desc {
    font-size: 0.85em;
    line-height: 1.5;
  }
  .start-btn {
    width: min(78vw, 420px);
    height: 3em;
  }
}

/* 컴팩트 2: 아주 낮은 화면(≤667px)에서 더 타이트하게 */
@media (max-height: 667px) {
  :root {
    --pos-title: 8svh;
    --pos-image: 31svh;
    --pos-desc: 56svh;
    --pos-dots: 74svh;
    --pos-footer: 84svh;
  }
  .image-wrap {
    height: 29vh;
    min-height: 10.5em;
  }
  .char-marquee-viewport {
    height: calc(7.5em * var(--charScale3) + 1.6em);
  }
  .dots {
    gap: 0.4em;
  }
}
